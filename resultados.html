<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados da Eleição - Patronato</title>
    <style>
        :root {
            --primary-color: #1a73e8;
            --secondary-color: #4285f4;
            --background-color: #f8f9fa;
            --text-color: #202124;
            --border-color: #dadce0;
            --success-color: #0f9d58;
            --warning-color: #f4b400;
            --error-color: #d93025;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        #status-message {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 8px;
        }

        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .candidate-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .candidate-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .candidate-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .candidate-votes {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .candidate-percentage {
            font-size: 1.2rem;
            color: var(--secondary-color);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.5s ease;
        }

        #remaining-votes {
            text-align: center;
            font-size: 1.2rem;
            margin-top: 2rem;
            padding: 1rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .candidate-card {
                padding: 1rem;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
    </style>
</head>
<body>
    <header>
        <h1>Resultados da Eleição - Patronato</h1>
    </header>

    <div class="container">
        <div id="status-message"></div>
        <div id="candidates-container" class="candidates-grid"></div>
        <div id="remaining-votes"></div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCF50W92_ZmSLGcDLlOr8r7QtF__JchP50",
            authDomain: "webuserdata.firebaseapp.com",
            databaseURL: "https://webuserdata-default-rtdb.firebaseio.com",
            projectId: "webuserdata",
            storageBucket: "webuserdata.appspot.com",
            messagingSenderId: "996591404387",
            appId: "1:996591404387:web:0d2f5d16b9494de4997f56",
            measurementId: "G-VTDKLXL5TS"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const MAX_VOTES = 8367;
        let totalVotes = 0;
        let candidatesData = [];

        function updateResults(votes) {
            const candidatesContainer = document.getElementById('candidates-container');
            candidatesContainer.innerHTML = '';

            totalVotes = Object.values(votes).reduce((sum, count) => sum + count, 0);
            candidatesData = Object.entries(votes).map(([name, count]) => ({
                name,
                votes: count,
                percentage: (count / totalVotes) * 100
            }));

            candidatesData.sort((a, b) => b.percentage - a.percentage);

            candidatesData.forEach(candidate => {
                const candidateCard = document.createElement('div');
                candidateCard.className = 'candidate-card fade-in';
                candidateCard.innerHTML = `
                    <div class="candidate-name">${candidate.name}</div>
                    <div class="candidate-votes">${candidate.votes}</div>
                    <div class="candidate-percentage">${candidate.percentage.toFixed(2)}%</div>
                    <div class="progress-bar">
                        <div class="progress" style="width: ${candidate.percentage}%"></div>
                    </div>
                `;
                candidatesContainer.appendChild(candidateCard);
            });

            updateStatusMessage();
            updateRemainingVotes();
        }

        function updateStatusMessage() {
            const statusMessage = document.getElementById('status-message');
            if (totalVotes >= MAX_VOTES) {
                statusMessage.textContent = "A votação foi encerrada.";
                statusMessage.style.backgroundColor = "var(--error-color)";
                statusMessage.style.color = "white";

                const winner = candidatesData[0];
                if (winner.percentage > 51) {
                    statusMessage.textContent += ` ${winner.name} foi eleito com ${winner.percentage.toFixed(2)}% dos votos.`;
                } else {
                    statusMessage.textContent += ` Haverá segundo turno entre ${candidatesData[0].name} e ${candidatesData[1].name}.`;
                }
            } else if (candidatesData[0].percentage > 51) {
                statusMessage.textContent = `${candidatesData[0].name} está liderando com ${candidatesData[0].percentage.toFixed(2)}% dos votos.`;
                statusMessage.style.backgroundColor = "var(--success-color)";
                statusMessage.style.color = "white";
            } else {
                statusMessage.textContent = "A votação está em andamento.";
                statusMessage.style.backgroundColor = "var(--warning-color)";
                statusMessage.style.color = "black";
            }
        }

        function updateRemainingVotes() {
            const remainingVotes = document.getElementById('remaining-votes');
            const votesLeft = MAX_VOTES - totalVotes;
            remainingVotes.textContent = `Faltam ${votesLeft} votos para encerrar a votação.`;
        }

        onValue(ref(database, 'votos'), (snapshot) => {
            const votes = snapshot.val() || {};
            updateResults(votes);
        });
    </script>
</body>
</html>
