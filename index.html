<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urna Eletrônica - Patronato</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg shadow-2xl max-w-md w-full">
        <h1 class="text-3xl font-bold text-center mb-6 text-blue-600">Urna Eletrônica - Patronato</h1>
        <form id="votingForm" class="space-y-4">
            <div>
                <label for="candidato" class="block text-sm font-medium text-gray-700">Selecione o candidato:</label>
                <select id="candidato" name="candidato" required class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="">Escolha um candidato</option>
                    <option value="Francisco Luciano">Francisco Luciano</option>
                    <option value="Karen Moura">Karen Moura</option>
                    <option value="Harison Xavier">Harison Xavier</option>
                    <option value="Saulo Costa">Saulo Costa</option>
                    <option value="Ribeiro Lima">Ribeiro Lima</option>
                    <option value="João Carlos De Lima">João Carlos De Lima</option>
                </select>
            </div>
            <div>
                <label for="secao" class="block text-sm font-medium text-gray-700">Selecione a seção:</label>
                <select id="secao" name="secao" required class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="">Escolha uma seção</option>
                    <option value="235">Seção 235</option>
                    <option value="67">Seção 67</option>
                    <option value="68">Seção 68</option>
                    <option value="619">Seção 619</option>
                    <option value="78">Seção 78</option>
                    <option value="Patronato">Seção Patronato</option>
                    <option value="628">Seção 628</option>
                </select>
            </div>
            <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                Votar
            </button>
        </form>
        <div id="mensagem" class="mt-4 text-center font-bold"></div>
        <div class="mt-6 text-center">
            <a href="resultados.html" class="text-blue-600 hover:text-blue-800 transition duration-150 ease-in-out">Ver Resultados</a>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, runTransaction, get } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCF50W92_ZmSLGcDLlOr8r7QtF__JchP50",
            authDomain: "webuserdata.firebaseapp.com",
            databaseURL: "https://webuserdata-default-rtdb.firebaseio.com",
            projectId: "webuserdata",
            storageBucket: "webuserdata.appspot.com",
            messagingSenderId: "996591404387",
            appId: "1:996591404387:web:0d2f5d16b9494de4997f56",
            measurementId: "G-VTDKLXL5TS"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        document.getElementById('votingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const candidato = document.getElementById('candidato').value;
            const secao = document.getElementById('secao').value;
            const mensagem = document.getElementById('mensagem');

            if (candidato && secao) {
                // Verificar o número total de votos
                get(ref(database, 'totalVotos')).then((snapshot) => {
                    const totalVotos = snapshot.val() || 0;
                    if (totalVotos >= 8367) {
                        mensagem.innerHTML = "A votação já foi encerrada. Limite de votos atingido.";
                        mensagem.className = "mt-4 text-center font-bold text-red-600";
                        return;
                    }

                    // Incrementar o voto para o candidato
                    runTransaction(ref(database, 'votos/' + candidato), (currentVotos) => {
                        return (currentVotos || 0) + 1;
                    });

                    // Incrementar o voto para a seção
                    runTransaction(ref(database, 'secoes/' + secao), (currentVotos) => {
                        return (currentVotos || 0) + 1;
                    });

                    // Incrementar o total de votos
                    runTransaction(ref(database, 'totalVotos'), (currentTotal) => {
                        return (currentTotal || 0) + 1;
                    });

                    mensagem.innerHTML = "Voto registrado com sucesso!";
                    mensagem.className = "mt-4 text-center font-bold text-green-600 pulse";

                    // Resetar o formulário
                    document.getElementById('votingForm').reset();

                    // Remover a animação após 3 segundos
                    setTimeout(() => {
                        mensagem.classList.remove('pulse');
                    }, 3000);
                });
            } else {
                mensagem.innerHTML = "Por favor, selecione um candidato e uma seção.";
                mensagem.className = "mt-4 text-center font-bold text-red-600";
            }
        });
    </script>
</body>
</html>
